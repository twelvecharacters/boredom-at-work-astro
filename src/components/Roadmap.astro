---
import { LEARNING_PATHS } from '../data/learning-paths';

interface Props {
  pathId: string;
  currentSlug?: string;
}

const { pathId, currentSlug } = Astro.props;
const path = LEARNING_PATHS.find(p => p.id === pathId);

if (!path) {
  throw new Error(`Learning path with ID "${pathId}" not found.`);
}

const currentStepIndex = path.steps.findIndex(s => s.slug === currentSlug);
---

<div class="roadmap-container my-12 p-8 bg-gray-50 rounded-2xl border border-gray-200 shadow-sm relative overflow-hidden">
  <!-- Progress Header -->
  <div class="flex items-center justify-between mb-10 relative z-10">
    <div>
      <h3 class="text-xs font-black uppercase tracking-[0.2em] text-blue-600 mb-1">Current Learning Path</h3>
      <p class="text-xl font-bold text-gray-900">{path.title}</p>
    </div>
    <div class="text-right">
      <div class="text-2xl font-black text-blue-600/20 tabular-nums">
        {currentStepIndex + 1} / {path.steps.length}
      </div>
      <div class="w-32 h-1.5 bg-gray-200 rounded-full mt-2 overflow-hidden">
        <div 
          class="h-full bg-blue-500 transition-all duration-1000 ease-out" 
          style={`width: ${((currentStepIndex + 1) / path.steps.length) * 100}%`}
        ></div>
      </div>
    </div>
  </div>

  <!-- Steps List -->
  <div class="space-y-6 relative z-10">
    {path.steps.map((step, index) => {
      const isCompleted = index < currentStepIndex;
      const isCurrent = index === currentStepIndex;
      const isFuture = index > currentStepIndex;
      
      return (
        <div class={`flex gap-6 group transition-opacity duration-300 ${isFuture ? 'opacity-50' : ''}`}>
          <div class="flex flex-col items-center">
            <div class={`
              w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm border-2 transition-all duration-500
              ${isCompleted ? 'bg-green-500 border-green-500 text-white shadow-lg shadow-green-200' : ''}
              ${isCurrent ? 'bg-blue-600 border-blue-600 text-white shadow-xl shadow-blue-200 animate-pulse' : ''}
              ${isFuture ? 'bg-white border-gray-300 text-gray-400' : ''}
            `}>
              {isCompleted ? '✓' : index + 1}
            </div>
            {index < path.steps.length - 1 && (
              <div class={`w-0.5 flex-grow my-2 transition-colors duration-500 ${isCompleted ? 'bg-green-500' : 'bg-gray-200'}`}></div>
            )}
          </div>
          <div class="flex-grow pt-1">
            <h4 class={`font-bold transition-colors ${isCurrent ? 'text-blue-600' : 'text-gray-900'}`}>
              {step.title}
            </h4>
            <p class="text-sm text-gray-500 mt-1 leading-relaxed">
              {step.description}
            </p>
            {isCurrent && (
                <div class="mt-4 inline-flex items-center gap-2 text-xs font-bold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-full border border-blue-100">
                    <span class="w-1.5 h-1.5 bg-blue-600 rounded-full animate-ping"></span>
                    Currently Learning
                </div>
            )}
            {!isCurrent && !isFuture && (
                <a href={`/${step.slug}/`} class="mt-4 inline-block text-xs font-bold text-gray-400 hover:text-blue-600 transition-colors no-underline">
                    Revisit Module →
                </a>
            )}
             {isFuture && (
                <div class="mt-4 text-xs font-bold text-gray-300 italic">
                    Locked Module
                </div>
            )}
          </div>
        </div>
      );
    })}
  </div>

  <!-- Decorative Background -->
  <div class="absolute -right-20 -bottom-20 w-64 h-64 bg-blue-100/50 rounded-full blur-3xl pointer-events-none"></div>
</div>

<style>
  .roadmap-container {
      --roadmap-accent: #2563eb;
  }
</style>
