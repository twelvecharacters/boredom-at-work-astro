---
import { SITE } from '../config';

interface Props {
  review: {
    rating: number;
    productName: string;
    productBrand?: string;
    priceRange?: string;
  };
  articleTitle: string;
  articleDescription: string;
  articleUrl: string;
  articleImage?: string;
  publishDate: Date;
  author: string;
}

const { review, articleTitle, articleDescription, articleUrl, articleImage, publishDate, author } = Astro.props;

const schemaData = {
  "@context": "https://schema.org",
  "@type": "Product",
  "name": review.productName,
  "description": articleDescription,
  ...(articleImage && { "image": `${SITE.url}${articleImage}` }),
  ...(review.productBrand && { "brand": { "@type": "Brand", "name": review.productBrand } }),
  ...(review.priceRange && { "offers": { "@type": "AggregateOffer", "priceRange": review.priceRange } }),
  "review": {
    "@type": "Review",
    "reviewRating": {
      "@type": "Rating",
      "ratingValue": review.rating,
      "bestRating": 5,
      "worstRating": 1
    },
    "author": {
      "@type": "Person",
      "name": author
    },
    "datePublished": publishDate.toISOString().split('T')[0],
    "reviewBody": articleDescription,
    "publisher": {
      "@type": "Organization",
      "name": SITE.title
    }
  },
};
---

<script type="application/ld+json" set:html={JSON.stringify(schemaData)} />
