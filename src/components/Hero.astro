---
import OptimizedImage from './OptimizedImage.astro';

interface Props {
  title: string;
  description: string;
  ctaText: string;
  ctaHref: string;
  typewriterPhrases?: string[];
}

const { title, description, ctaText, ctaHref, typewriterPhrases = [] } = Astro.props;
---

<section class="mesh-gradient text-white py-20 md:py-32 relative overflow-hidden hero-section">
  <!-- Interactive Background Blobs (contain to prevent CLS) -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none" aria-hidden="true" style="contain: layout style paint;">
    <div class="absolute top-[10%] left-[10%] w-[400px] h-[400px] bg-accent/20 rounded-full blur-[100px] parallax-blob floating will-change-transform" data-speed="0.05"></div>
    <div class="absolute bottom-[10%] right-[10%] w-[500px] h-[500px] bg-primary-light/30 rounded-full blur-[120px] parallax-blob floating-delayed will-change-transform" data-speed="0.08"></div>
    <div class="absolute top-[40%] right-[20%] w-[300px] h-[300px] bg-accent-alt/10 rounded-full blur-[80px] parallax-blob floating-slow will-change-transform" data-speed="0.03"></div>
  </div>

  <div class="max-w-4xl mx-auto px-4 text-center relative z-10">
    <div class="inline-block bg-white/10 backdrop-blur-sm border border-white/20 px-4 py-1.5 rounded-full text-sm font-medium mb-6 floating animate-in fade-in slide-in-from-bottom-4 duration-1000">
      ðŸš€ Use your downtime wisely
    </div>
    <h1 class="text-4xl md:text-7xl font-bold mb-6 text-gradient leading-tight tracking-tight animate-in fade-in slide-in-from-bottom-6 duration-1000 delay-150">
      {typewriterPhrases.length > 0 ? (
        <span id="typewriter" data-phrases={JSON.stringify(typewriterPhrases)}>{title}</span><span class="typewriter-cursor">|</span>
      ) : (
        title
      )}
    </h1>
    <p class="text-lg md:text-xl text-white/70 mb-10 max-w-2xl mx-auto leading-relaxed animate-in fade-in slide-in-from-bottom-8 duration-1000 delay-300">
      {description}
    </p>
    <div class="flex flex-col sm:flex-row items-center justify-center gap-4 animate-in fade-in slide-in-from-bottom-10 duration-1000 delay-500">
      <div class="magnetic-wrap">
        <a href={ctaHref} class="btn-primary text-lg shadow-2xl shadow-accent/20 hover:scale-105 transition-all duration-300 magnetic-content">
          {ctaText}
        </a>
      </div>
      <span class="text-white/40 text-sm hidden sm:block">No boss required.</span>
    </div>
  </div>
</section>


<script>
  function initHeroEffects() {
    const hero = document.querySelector('.hero-section') as HTMLElement;
    if (!hero) return;

    const blobs = hero.querySelectorAll('.parallax-blob');
    const magneticContent = hero.querySelector('.magnetic-content') as HTMLElement;
    const magneticWrap = hero.querySelector('.magnetic-wrap') as HTMLElement;
    const typewriterElement = document.getElementById('typewriter');

    // Typewriter Logic
    if (typewriterElement) {
      const phrases = JSON.parse(typewriterElement.getAttribute('data-phrases') || '[]');
      let phraseIndex = 0;
      let charIndex = 0;
      let isDeleting = false;
      let typingSpeed = 100;

      function type() {
        if (!typewriterElement) return;
        const currentPhrase = phrases[phraseIndex];
        
        if (isDeleting) {
          typewriterElement.textContent = currentPhrase.substring(0, charIndex - 1);
          charIndex--;
          typingSpeed = 50;
        } else {
          typewriterElement.textContent = currentPhrase.substring(0, charIndex + 1);
          charIndex++;
          typingSpeed = 100;
        }

        if (!isDeleting && charIndex === currentPhrase.length) {
          isDeleting = true;
          typingSpeed = 2000; // Pause at end
        } else if (isDeleting && charIndex === 0) {
          isDeleting = false;
          phraseIndex = (phraseIndex + 1) % phrases.length;
          typingSpeed = 500;
        }

        setTimeout(type, typingSpeed);
      }

      if (phrases.length > 0) {
        type();
      }
    }

    // Parallax & Mouse Radial Effect
    hero.addEventListener('mousemove', (e: MouseEvent) => {
      const rect = hero.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      hero.style.setProperty('--mouse-x', `${x}px`);
      hero.style.setProperty('--mouse-y', `${y}px`);

      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      const moveX = (e.clientX - centerX) / centerX;
      const moveY = (e.clientY - centerY) / centerY;

      blobs.forEach((blob) => {
        const speed = parseFloat(blob.getAttribute('data-speed') || '0.05');
        (blob as HTMLElement).style.transform = `translate(${moveX * speed * 100}px, ${moveY * speed * 100}px)`;
      });

      // Magnetic Button
      if (magneticWrap && magneticContent) {
        const wrapRect = magneticWrap.getBoundingClientRect();
        const contentX = e.clientX - (wrapRect.left + wrapRect.width / 2);
        const contentY = e.clientY - (wrapRect.top + wrapRect.height / 2);
        const distance = Math.sqrt(contentX * contentX + contentY * contentY);

        if (distance < 100) {
          magneticContent.style.transform = `translate(${contentX * 0.3}px, ${contentY * 0.3}px) scale(1.05)`;
        } else {
          magneticContent.style.transform = '';
        }
      }
    });

    hero.addEventListener('mouseleave', () => {
      blobs.forEach(blob => (blob as HTMLElement).style.transform = '');
      if (magneticContent) magneticContent.style.transform = '';
    });
  }

  // Initialize
  initHeroEffects();
  document.addEventListener('astro:after-swap', initHeroEffects);
</script>

<style>
  .magnetic-wrap {
    display: inline-block;
    padding: 20px;
    margin: -20px;
  }
  .magnetic-content {
    display: inline-block;
    will-change: transform;
    transition: transform 0.2s cubic-bezier(0.33, 1, 0.68, 1);
  }
  .typewriter-cursor {
    display: inline-block;
    margin-left: 2px;
    animation: blink 1s step-end infinite;
    color: var(--color-accent, #6366f1);
  }
  @keyframes blink {
    from, to { opacity: 1; }
    50% { opacity: 0; }
  }
</style>

